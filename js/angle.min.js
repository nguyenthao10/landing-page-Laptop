(function(){"use strict";function t(){e(),n(),r(),s(),c(),o(N.offsetWidth,N.offsetHeight),h()}function e(){v=new p.CanvasRenderer,i(M.renderer)}function i(t){d=v,d.setSize(N.offsetWidth,N.offsetHeight),I.appendChild(d.element)}function n(){m=new p.Scene}function r(){d.clear(),y=new p.Plane(x.width*d.width,x.height*d.height,x.slices),b=new p.Material(x.ambient,x.diffuse),g=new p.Mesh(y,b),m.add(g)}function s(){d.clear();var t=new p.Light(V.ambient,V.diffuse);t.ambientHex=t.ambient.format(),t.diffuseHex=t.diffuse.format(),t.setPosition(V.xPos,V.yPos,V.zOffset),m.add(t),V.proxy=t,V.pickedup=!0}function o(t,e){d.setSize(t,e),p.Vector3.set(S,d.halfWidth,d.halfHeight),r()}function h(){a(),requestAnimationFrame(h)}function a(){d.render(m)}function c(){window.addEventListener("resize",u),window.addEventListener("mousemove",l)}function u(t){o(N.offsetWidth,N.offsetHeight),a()}function l(t){V.pickedup&&(V.xPos=t.x-d.width/2,V.yPos=d.height/2-t.y,V.proxy.setPosition(V.xPos,V.yPos,V.proxy.position[2]))}var f;(function(){function t(t){var e,i,n,r,s,o,h=Number.POSITIVE_INFINITY,a=Number.POSITIVE_INFINITY,c=Number.NEGATIVE_INFINITY,u=Number.NEGATIVE_INFINITY;for(e=t.length;e--;)t[e][0]<h&&(h=t[e][0]),t[e][0]>c&&(c=t[e][0]),t[e][1]<a&&(a=t[e][1]),t[e][1]>u&&(u=t[e][1]);return i=c-h,n=u-a,r=Math.max(i,n),s=h+.5*i,o=a+.5*n,[[s-20*r,o-r],[s,o+20*r],[s+20*r,o-r]]}function e(t,e,i,r){var s,o,h,a,c,u,l,f,p,d,m=t[e][0],g=t[e][1],y=t[i][0],b=t[i][1],v=t[r][0],x=t[r][1],V=Math.abs(g-b),w=Math.abs(b-x);if(V<n&&w<n)throw new Error("Eek! Coincident points!");return V<n?(a=-(v-y)/(x-b),u=(y+v)/2,f=(b+x)/2,s=(y+m)/2,o=a*(s-u)+f):w<n?(h=-(y-m)/(b-g),c=(m+y)/2,l=(g+b)/2,s=(v+y)/2,o=h*(s-c)+l):(h=-(y-m)/(b-g),a=-(v-y)/(x-b),c=(m+y)/2,u=(y+v)/2,l=(g+b)/2,f=(b+x)/2,s=(h*c-a*u+f-l)/(h-a),o=V>w?h*(s-c)+l:a*(s-u)+f),p=y-s,d=b-o,{i:e,j:i,k:r,x:s,y:o,r:p*p+d*d}}function i(t){var e,i,n,r,s,o;for(i=t.length;i;)for(r=t[--i],n=t[--i],e=i;e;)if(o=t[--e],s=t[--e],n===s&&r===o||n===o&&r===s){t.splice(i,2),t.splice(e,2);break}}var n=1/1048576;f={triangulate:function(r,s){var o,h,a,c,u,l,f,p,d,m,g,y,b=r.length;if(b<3)return[];if(r=r.slice(0),s)for(o=b;o--;)r[o]=r[o][s];for(a=new Array(b),o=b;o--;)a[o]=o;for(a.sort(function(t,e){return r[e][0]-r[t][0]}),c=t(r),r.push(c[0],c[1],c[2]),u=[e(r,b+0,b+1,b+2)],l=[],f=[],o=a.length;o--;f.length=0){for(y=a[o],h=u.length;h--;)p=r[y][0]-u[h].x,p>0&&p*p>u[h].r?(l.push(u[h]),u.splice(h,1)):(d=r[y][1]-u[h].y,p*p+d*d-u[h].r>n||(f.push(u[h].i,u[h].j,u[h].j,u[h].k,u[h].k,u[h].i),u.splice(h,1)));for(i(f),h=f.length;h;)g=f[--h],m=f[--h],u.push(e(r,m,g,y))}for(o=u.length;o--;)l.push(u[o]);for(u.length=0,o=l.length;o--;)l[o].i<b&&l[o].j<b&&l[o].k<b&&u.push(l[o].i,l[o].j,l[o].k);return u},contains:function(t,e){if(e[0]<t[0][0]&&e[0]<t[1][0]&&e[0]<t[2][0]||e[0]>t[0][0]&&e[0]>t[1][0]&&e[0]>t[2][0]||e[1]<t[0][1]&&e[1]<t[1][1]&&e[1]<t[2][1]||e[1]>t[0][1]&&e[1]>t[1][1]&&e[1]>t[2][1])return null;var i=t[1][0]-t[0][0],n=t[2][0]-t[0][0],r=t[1][1]-t[0][1],s=t[2][1]-t[0][1],o=i*s-n*r;if(0===o)return null;var h=(s*(e[0]-t[0][0])-n*(e[1]-t[0][1]))/o,a=(i*(e[1]-t[0][1])-r*(e[0]-t[0][0]))/o;return h<0||a<0||h+a>1?null:[h,a]}},"undefined"!=typeof module&&(module.exports=f)})();var p={FRONT:0,BACK:1,DOUBLE:2,SVGNS:"http://www.w3.org/2000/svg"};p.Array="function"==typeof Float32Array?Float32Array:Array,p.Utils={isNumber:function(t){return!isNaN(parseFloat(t))&&isFinite(t)}},Math.PIM2=2*Math.PI,Math.PID2=Math.PI/2,Math.randomInRange=function(t,e){return t+(e-t)*Math.random()},Math.clamp=function(t,e,i){return t=Math.max(t,e),t=Math.min(t,i),t},p.Vector3={create:function(t,e,i){var n=new p.Array(3);return this.set(n,t,e,i),n},clone:function(t){var e=this.create();return this.copy(e,t),e},set:function(t,e,i,n){return t[0]=e||0,t[1]=i||0,t[2]=n||0,this},setX:function(t,e){return t[0]=e||0,this},setY:function(t,e){return t[1]=e||0,this},setZ:function(t,e){return t[2]=e||0,this},copy:function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],this},add:function(t,e){return t[0]+=e[0],t[1]+=e[1],t[2]+=e[2],this},addVectors:function(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2],this},addScalar:function(t,e){return t[0]+=e,t[1]+=e,t[2]+=e,this},subtract:function(t,e){return t[0]-=e[0],t[1]-=e[1],t[2]-=e[2],this},subtractVectors:function(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2],this},subtractScalar:function(t,e){return t[0]-=e,t[1]-=e,t[2]-=e,this},multiply:function(t,e){return t[0]*=e[0],t[1]*=e[1],t[2]*=e[2],this},multiplyVectors:function(t,e,i){return t[0]=e[0]*i[0],t[1]=e[1]*i[1],t[2]=e[2]*i[2],this},multiplyScalar:function(t,e){return t[0]*=e,t[1]*=e,t[2]*=e,this},divide:function(t,e){return t[0]/=e[0],t[1]/=e[1],t[2]/=e[2],this},divideVectors:function(t,e,i){return t[0]=e[0]/i[0],t[1]=e[1]/i[1],t[2]=e[2]/i[2],this},divideScalar:function(t,e){return 0!==e?(t[0]/=e,t[1]/=e,t[2]/=e):(t[0]=0,t[1]=0,t[2]=0),this},cross:function(t,e){var i=t[0],n=t[1],r=t[2];return t[0]=n*e[2]-r*e[1],t[1]=r*e[0]-i*e[2],t[2]=i*e[1]-n*e[0],this},crossVectors:function(t,e,i){return t[0]=e[1]*i[2]-e[2]*i[1],t[1]=e[2]*i[0]-e[0]*i[2],t[2]=e[0]*i[1]-e[1]*i[0],this},min:function(t,e){return t[0]<e&&(t[0]=e),t[1]<e&&(t[1]=e),t[2]<e&&(t[2]=e),this},max:function(t,e){return t[0]>e&&(t[0]=e),t[1]>e&&(t[1]=e),t[2]>e&&(t[2]=e),this},clamp:function(t,e,i){return this.min(t,e),this.max(t,i),this},limit:function(t,e,i){var n=this.length(t);return null!==e&&n<e?this.setLength(t,e):null!==i&&n>i&&this.setLength(t,i),this},dot:function(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]},normalise:function(t){return this.divideScalar(t,this.length(t))},negate:function(t){return this.multiplyScalar(t,-1)},distanceSquared:function(t,e){var i=t[0]-e[0],n=t[1]-e[1],r=t[2]-e[2];return i*i+n*n+r*r},distance:function(t,e){return Math.sqrt(this.distanceSquared(t,e))},lengthSquared:function(t){return t[0]*t[0]+t[1]*t[1]+t[2]*t[2]},length:function(t){return Math.sqrt(this.lengthSquared(t))},setLength:function(t,e){var i=this.length(t);return 0!==i&&e!==i&&this.multiplyScalar(t,e/i),this}},p.Vector4={create:function(t,e,i,n){var r=new p.Array(4);return this.set(r,t,e,i),r},set:function(t,e,i,n,r){return t[0]=e||0,t[1]=i||0,t[2]=n||0,t[3]=r||0,this},setX:function(t,e){return t[0]=e||0,this},setY:function(t,e){return t[1]=e||0,this},setZ:function(t,e){return t[2]=e||0,this},setW:function(t,e){return t[3]=e||0,this},add:function(t,e){return t[0]+=e[0],t[1]+=e[1],t[2]+=e[2],t[3]+=e[3],this},multiplyVectors:function(t,e,i){return t[0]=e[0]*i[0],t[1]=e[1]*i[1],t[2]=e[2]*i[2],t[3]=e[3]*i[3],this},multiplyScalar:function(t,e){return t[0]*=e,t[1]*=e,t[2]*=e,t[3]*=e,this},min:function(t,e){return t[0]<e&&(t[0]=e),t[1]<e&&(t[1]=e),t[2]<e&&(t[2]=e),t[3]<e&&(t[3]=e),this},max:function(t,e){return t[0]>e&&(t[0]=e),t[1]>e&&(t[1]=e),t[2]>e&&(t[2]=e),t[3]>e&&(t[3]=e),this},clamp:function(t,e,i){return this.min(t,e),this.max(t,i),this}},p.Color=function(t,e){this.rgba=p.Vector4.create(),this.hex=t||"#000000",this.opacity=p.Utils.isNumber(e)?e:1,this.set(this.hex,this.opacity)},p.Color.prototype={set:function(t,e){t=t.replace("#","");var i=t.length/3;return this.rgba[0]=parseInt(t.substring(0*i,1*i),16)/255,this.rgba[1]=parseInt(t.substring(1*i,2*i),16)/255,this.rgba[2]=parseInt(t.substring(2*i,3*i),16)/255,this.rgba[3]=p.Utils.isNumber(e)?e:this.rgba[3],this},hexify:function(t){var e=Math.ceil(255*t).toString(16);return 1===e.length&&(e="0"+e),e},format:function(){var t=this.hexify(this.rgba[0]),e=this.hexify(this.rgba[1]),i=this.hexify(this.rgba[2]);return this.hex="#"+t+e+i,this.hex}},p.Object=function(){this.position=p.Vector3.create()},p.Object.prototype={setPosition:function(t,e,i){return p.Vector3.set(this.position,t,e,i),this}},p.Light=function(t,e){p.Object.call(this),this.ambient=new p.Color(t),this.diffuse=new p.Color(e),this.ray=p.Vector3.create()},p.Light.prototype=Object.create(p.Object.prototype),p.Vertex=function(t,e,i){this.position=p.Vector3.create(t,e,i)},p.Triangle=function(t,e,i){this.a=t||new p.Vertex,this.b=e||new p.Vertex,this.c=i||new p.Vertex,this.vertices=[this.a,this.b,this.c],this.u=p.Vector3.create(),this.v=p.Vector3.create(),this.centroid=p.Vector3.create(),this.normal=p.Vector3.create(),this.color=new p.Color,this.polygon=document.createElementNS(p.SVGNS,"polygon"),this.polygon.setAttributeNS(null,"stroke-linejoin","round"),this.polygon.setAttributeNS(null,"stroke-miterlimit","1"),this.polygon.setAttributeNS(null,"stroke-width","1"),this.computeCentroid(),this.computeNormal()},p.Triangle.prototype={computeCentroid:function(){return this.centroid[0]=this.a.position[0]+this.b.position[0]+this.c.position[0],this.centroid[1]=this.a.position[1]+this.b.position[1]+this.c.position[1],this.centroid[2]=this.a.position[2]+this.b.position[2]+this.c.position[2],p.Vector3.divideScalar(this.centroid,3),this},computeNormal:function(){return p.Vector3.subtractVectors(this.u,this.b.position,this.a.position),p.Vector3.subtractVectors(this.v,this.c.position,this.a.position),p.Vector3.crossVectors(this.normal,this.u,this.v),p.Vector3.normalise(this.normal),this}},p.Geometry=function(){this.vertices=[],this.triangles=[],this.dirty=!1},p.Geometry.prototype={update:function(){if(this.dirty){var t,e;for(t=this.triangles.length-1;t>=0;t--)e=this.triangles[t],e.computeCentroid(),e.computeNormal();this.dirty=!1}return this}},p.Plane=function(t,e,i){p.Geometry.call(this),this.width=t||100,this.height=e||100;var n,r,s=new Array(i),o=-.5*this.width,h=.5*this.height;for(a=s.length;a--;)n=o+Math.random()*t,r=h-Math.random()*e,s[a]=[n,r];s.push([o,h]),s.push([o+t/2,h]),s.push([o+t,h]),s.push([o+t,h-e/2]),s.push([o+t,h-e]),s.push([o+t/2,h-e]),s.push([o,h-e]),s.push([o,h-e/2]);for(var a=6;a>=0;a--)s.push([o+Math.random()*t,h]),s.push([o,h-Math.random()*e]),s.push([o+t,h-Math.random()*e]),s.push([o+Math.random()*t,h-e]);var c=f.triangulate(s);for(a=c.length;a;){--a;var u=[Math.ceil(s[c[a]][0]),Math.ceil(s[c[a]][1])];--a;var l=[Math.ceil(s[c[a]][0]),Math.ceil(s[c[a]][1])];--a;var d=[Math.ceil(s[c[a]][0]),Math.ceil(s[c[a]][1])],m=new p.Triangle(new p.Vertex(u[0],u[1]),new p.Vertex(l[0],l[1]),new p.Vertex(d[0],d[1]));this.triangles.push(m)}},p.Plane.prototype=Object.create(p.Geometry.prototype),p.Material=function(t,e){this.ambient=new p.Color(t||"#444444"),this.diffuse=new p.Color(e||"#FFFFFF"),this.slave=new p.Color},p.Mesh=function(t,e){p.Object.call(this),this.geometry=t||new p.Geometry,this.material=e||new p.Material,this.side=p.FRONT,this.visible=!0},p.Mesh.prototype=Object.create(p.Object.prototype),p.Mesh.prototype.update=function(t,e){var i,n,r,s,o;if(this.geometry.update(),e)for(i=this.geometry.triangles.length-1;i>=0;i--){for(n=this.geometry.triangles[i],p.Vector4.set(n.color.rgba),r=t.length-1;r>=0;r--)s=t[r],p.Vector3.subtractVectors(s.ray,s.position,n.centroid),p.Vector3.normalise(s.ray),o=p.Vector3.dot(n.normal,s.ray),this.side===p.FRONT?o=Math.max(o,0):this.side===p.BACK?o=Math.abs(Math.min(o,0)):this.side===p.DOUBLE&&(o=Math.max(Math.abs(o),0)),p.Vector4.multiplyVectors(this.material.slave.rgba,this.material.ambient.rgba,s.ambient.rgba),p.Vector4.add(n.color.rgba,this.material.slave.rgba),p.Vector4.multiplyVectors(this.material.slave.rgba,this.material.diffuse.rgba,s.diffuse.rgba),p.Vector4.multiplyScalar(this.material.slave.rgba,o),p.Vector4.add(n.color.rgba,this.material.slave.rgba);p.Vector4.clamp(n.color.rgba,0,1)}return this},p.Scene=function(){this.meshes=[],this.lights=[]},p.Scene.prototype={add:function(t){return t instanceof p.Mesh&&!~this.meshes.indexOf(t)?this.meshes.push(t):t instanceof p.Light&&!~this.lights.indexOf(t)&&this.lights.push(t),this}},p.Renderer=function(){this.width=0,this.height=0,this.halfWidth=0,this.halfHeight=0},p.Renderer.prototype={setSize:function(t,e){if(this.width!==t||this.height!==e)return this.width=t,this.height=e,this.halfWidth=.5*this.width,this.halfHeight=.5*this.height,this},clear:function(){return this},render:function(t){return this}},p.CanvasRenderer=function(){p.Renderer.call(this),this.element=document.createElement("canvas"),this.element.style.display="block",this.context=this.element.getContext("2d"),this.setSize(this.element.width,this.element.height)},p.CanvasRenderer.prototype=Object.create(p.Renderer.prototype),p.CanvasRenderer.prototype.setSize=function(t,e){return p.Renderer.prototype.setSize.call(this,t,e),this.element.width=t,this.element.height=e,this.context.setTransform(1,0,0,-1,this.halfWidth,this.halfHeight),this},p.CanvasRenderer.prototype.clear=function(){return p.Renderer.prototype.clear.call(this),this.context.clearRect(-this.halfWidth,-this.halfHeight,this.width,this.height),this},p.CanvasRenderer.prototype.render=function(t){var e,i,n,r,s;for(p.Renderer.prototype.render.call(this,t),this.clear(),this.context.lineJoin="round",this.context.lineWidth=1,e=t.meshes.length-1;e>=0;e--)if(i=t.meshes[e],i.visible)for(i.update(t.lights,!0),n=i.geometry.triangles.length-1;n>=0;n--)r=i.geometry.triangles[n],s=r.color.format(),this.context.beginPath(),this.context.moveTo(r.a.position[0],r.a.position[1]),this.context.lineTo(r.b.position[0],r.b.position[1]),this.context.lineTo(r.c.position[0],r.c.position[1]),this.context.closePath(),this.context.strokeStyle=s,this.context.fillStyle=s,this.context.stroke(),this.context.fill();return this};var d,m,g,y,b,v,x={width:1.2,height:1.2,slices:250,ambient:"#999999",diffuse:"#AAAAAA"},V={count:1,xPos:0,yPos:200,zOffset:100,ambient:"#00C699",diffuse:"#00C699",pickedup:!0,proxy:!1},w="canvas",M={renderer:w},S=p.Vector3.create(),N=document.getElementById("angle-bg"),I=document.getElementById("angle-bg");t()})();